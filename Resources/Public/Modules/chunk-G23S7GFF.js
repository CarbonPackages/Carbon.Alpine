function K(a,l,n,h){return{items:[],activeKey:f(a),orderedKeys:[],activatedByKeyPress:!1,activateSelectedOrFirst:a.debounce(function(){h(!1)}),registerItemsQueue:[],registerItem(e,t,s,i){this.registerItemsQueue.length===0&&queueMicrotask(()=>{this.registerItemsQueue.length>0&&(this.items=this.items.concat(this.registerItemsQueue),this.registerItemsQueue=[],this.reorderKeys(),this.activateSelectedOrFirst())});let r={key:e,el:t,value:s,disabled:i};this.registerItemsQueue.push(r)},unregisterKeysQueue:[],unregisterItem(e){this.unregisterKeysQueue.length===0&&queueMicrotask(()=>{this.unregisterKeysQueue.length>0&&(this.items=this.items.filter(t=>!this.unregisterKeysQueue.includes(t.key)),this.orderedKeys=this.orderedKeys.filter(t=>!this.unregisterKeysQueue.includes(t)),this.unregisterKeysQueue=[],this.reorderKeys(),this.activateSelectedOrFirst())}),this.unregisterKeysQueue.push(e)},getItemByKey(e){return this.items.find(t=>t.key===e)},getItemByValue(e){return this.items.find(t=>a.raw(t.value)===a.raw(e))},getItemByEl(e){return this.items.find(t=>t.el===e)},getItemsByValues(e){let t=e.map(i=>a.raw(i)),s=this.items.filter(i=>t.includes(a.raw(i.value)));return s=s.slice().sort((i,r)=>{let u=i.el.compareDocumentPosition(r.el);return u&Node.DOCUMENT_POSITION_FOLLOWING?-1:u&Node.DOCUMENT_POSITION_PRECEDING?1:0}),s},getActiveItem(){if(!this.hasActive())return null;let e=this.items.find(t=>t.key===this.activeKey.get());return e||this.deactivateKey(this.activeKey.get()),e},activateItem(e){e&&this.activateKey(e.key)},reorderKeys:a.debounce(function(){this.orderedKeys=this.items.map(e=>e.key),this.orderedKeys=this.orderedKeys.slice().sort((e,t)=>{if(e===null||t===null)return 0;let s=this.items.find(u=>u.key===e).el,i=this.items.find(u=>u.key===t).el,r=s.compareDocumentPosition(i);return r&Node.DOCUMENT_POSITION_FOLLOWING?-1:r&Node.DOCUMENT_POSITION_PRECEDING?1:0}),this.orderedKeys.includes(this.activeKey.get())||this.deactivateKey(this.activeKey.get())}),getActiveKey(){return this.activeKey.get()},activeEl(){if(this.activeKey.get())return this.items.find(e=>e.key===this.activeKey.get()).el},isActiveEl(e){let t=this.items.find(s=>s.el===e);return this.activeKey.is(t)},activateEl(e){let t=this.items.find(s=>s.el===e);this.activateKey(t.key)},isDisabledEl(e){return this.items.find(t=>t.el===e).disabled},get isScrollingTo(){return this.scrollingCount>0},scrollingCount:0,activateAndScrollToKey(e,t){if(!this.getItemByKey(e))return;this.scrollingCount++,this.activateKey(e,t),this.items.find(i=>i.key===e).el.scrollIntoView({block:"nearest"}),setTimeout(()=>{this.scrollingCount--},25)},isDisabled(e){let t=this.items.find(s=>s.key===e);return t?t.disabled:!1},get nonDisabledOrderedKeys(){return this.orderedKeys.filter(e=>!this.isDisabled(e))},hasActive(){return!!this.activeKey.get()},wasActivatedByKeyPress(){return this.activatedByKeyPress},isActiveKey(e){return this.activeKey.is(e)},activateKey(e,t=!1){this.isDisabled(e)||(this.activeKey.set(e),this.activatedByKeyPress=t)},deactivateKey(e){this.activeKey.get()===e&&(this.activeKey.set(null),this.activatedByKeyPress=!1)},deactivate(){this.activeKey.get()&&(this.isScrollingTo||(this.activeKey.set(null),this.activatedByKeyPress=!1))},nextKey(){if(!this.activeKey.get())return;let e=this.nonDisabledOrderedKeys.findIndex(t=>t===this.activeKey.get());return this.nonDisabledOrderedKeys[e+1]},prevKey(){if(!this.activeKey.get())return;let e=this.nonDisabledOrderedKeys.findIndex(t=>t===this.activeKey.get());return this.nonDisabledOrderedKeys[e-1]},firstKey(){return this.nonDisabledOrderedKeys[0]},lastKey(){return this.nonDisabledOrderedKeys[this.nonDisabledOrderedKeys.length-1]},searchQuery:"",clearSearch:a.debounce(function(){this.searchQuery=""},350),searchKey(e){this.clearSearch(),this.searchQuery+=e;let t;for(let s in this.items)if(this.items[s].el.textContent.trim().toLowerCase().startsWith(this.searchQuery)){t=this.items[s].key;break}if(this.nonDisabledOrderedKeys.includes(t))return t},activateByKeyEvent(e,t=!1,s=()=>!1,i=()=>{},r){let u,d;r(!0);let c=!0;switch(e.key){case["ArrowDown","ArrowRight"][n==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),r(!1),!s()){i();break}this.reorderKeys(),d=this.hasActive(),u=d?this.nextKey():this.firstKey();break;case["ArrowUp","ArrowLeft"][n==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),r(!1),!s()){i();break}this.reorderKeys(),d=this.hasActive(),u=d?this.prevKey():this.lastKey();break;case"Home":case"PageUp":if(e.key=="Home"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),r(!1),this.reorderKeys(),d=this.hasActive(),u=this.firstKey();break;case"End":case"PageDown":if(e.key=="End"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),r(!1),this.reorderKeys(),d=this.hasActive(),u=this.lastKey();break;default:c=this.activatedByKeyPress,t&&e.key.length===1&&(u=this.searchKey(e.key));break}u&&this.activateAndScrollToKey(u,c)}}}function v(a,l,n,h){let e=y(n,h);e.forEach(i=>i._x_hiddenInput=!0),e.forEach(i=>i._x_ignore=!0);let t=l.children,s=[];for(let i=0;i<t.length;i++){let r=t[i];if(r._x_hiddenInput)s.push(r);else break}a.mutateDom(()=>{s.forEach(i=>i.remove()),e.reverse().forEach(i=>l.prepend(i))})}function y(a,l,n=[]){if(o(l))for(let h in l)n=n.concat(y(`${a}[${h}]`,l[h]));else{let h=document.createElement("input");return h.setAttribute("type","hidden"),h.setAttribute("name",a),h.setAttribute("value",""+l),[h]}return n}function o(a){return typeof a=="object"&&a!==null}function f(a,l){let n={},h,e=a.reactive({state:!1}),t=()=>(e.state,h),s=r=>{r!==h&&(h!==void 0&&(n[h].state=!1),h=r,n[r]===void 0?n[r]=a.reactive({state:!0}):n[r].state=!0,e.state=!e.state)},i=r=>n[r]===void 0?(n[r]=a.reactive({state:!1}),n[r].state):!!n[r].state;return l===void 0||s(l),{get:t,set:s,is:i}}export{K as a,v as b};
