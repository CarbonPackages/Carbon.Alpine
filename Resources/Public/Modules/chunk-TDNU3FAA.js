function f(s,h,d,l){return{items:[],activeKey:null,orderedKeys:[],activatedByKeyPress:!1,activateSelectedOrFirst:s.debounce(function(){l(!1)}),registerItem(e,t,r,i){this.items.push({key:e,el:t,value:r,disabled:i}),this.orderedKeys.push(e),this.reorderKeys(),this.activateSelectedOrFirst()},unregisterItem(e){let t=this.items.findIndex(r=>r.key===e);t!==-1&&this.items.splice(t,1),t=this.orderedKeys.indexOf(e),t!==-1&&this.orderedKeys.splice(t,1),this.reorderKeys(),this.activateSelectedOrFirst()},getItemByKey(e){return this.items.find(t=>t.key===e)},getItemByValue(e){return this.items.find(t=>s.raw(t.value)===s.raw(e))},getItemByEl(e){return this.items.find(t=>t.el===e)},getItemsByValues(e){let t=e.map(i=>s.raw(i)),r=this.items.filter(i=>t.includes(s.raw(i.value)));return r=r.slice().sort((i,n)=>{let a=i.el.compareDocumentPosition(n.el);return a&Node.DOCUMENT_POSITION_FOLLOWING?-1:a&Node.DOCUMENT_POSITION_PRECEDING?1:0}),r},getActiveItem(){if(!this.hasActive())return null;let e=this.items.find(t=>t.key===this.activeKey);return e||this.deactivateKey(this.activeKey),e},activateItem(e){e&&this.activateKey(e.key)},reorderKeys:s.debounce(function(){this.orderedKeys=this.items.map(e=>e.key),this.orderedKeys=this.orderedKeys.slice().sort((e,t)=>{if(e===null||t===null)return 0;let r=this.items.find(a=>a.key===e).el,i=this.items.find(a=>a.key===t).el,n=r.compareDocumentPosition(i);return n&Node.DOCUMENT_POSITION_FOLLOWING?-1:n&Node.DOCUMENT_POSITION_PRECEDING?1:0}),this.orderedKeys.includes(this.activeKey)||this.deactivateKey(this.activeKey)}),activeEl(){if(this.activeKey)return this.items.find(e=>e.key===this.activeKey).el},isActiveEl(e){let t=this.items.find(r=>r.el===e);return this.activeKey===t},activateEl(e){let t=this.items.find(r=>r.el===e);this.activateKey(t.key)},isDisabledEl(e){return this.items.find(t=>t.el===e).disabled},get isScrollingTo(){return this.scrollingCount>0},scrollingCount:0,activateAndScrollToKey(e,t){if(!this.getItemByKey(e))return;this.scrollingCount++,this.activateKey(e,t),this.items.find(i=>i.key===e).el.scrollIntoView({block:"nearest"}),setTimeout(()=>{this.scrollingCount--},25)},isDisabled(e){let t=this.items.find(r=>r.key===e);return t?t.disabled:!1},get nonDisabledOrderedKeys(){return this.orderedKeys.filter(e=>!this.isDisabled(e))},hasActive(){return!!this.activeKey},wasActivatedByKeyPress(){return this.activatedByKeyPress},isActiveKey(e){return this.activeKey===e},activateKey(e,t=!1){this.isDisabled(e)||(this.activeKey=e,this.activatedByKeyPress=t)},deactivateKey(e){this.activeKey===e&&(this.activeKey=null,this.activatedByKeyPress=!1)},deactivate(){this.activeKey&&(this.isScrollingTo||(this.activeKey=null,this.activatedByKeyPress=!1))},nextKey(){if(!this.activeKey)return;let e=this.nonDisabledOrderedKeys.findIndex(t=>t===this.activeKey);return this.nonDisabledOrderedKeys[e+1]},prevKey(){if(!this.activeKey)return;let e=this.nonDisabledOrderedKeys.findIndex(t=>t===this.activeKey);return this.nonDisabledOrderedKeys[e-1]},firstKey(){return this.nonDisabledOrderedKeys[0]},lastKey(){return this.nonDisabledOrderedKeys[this.nonDisabledOrderedKeys.length-1]},searchQuery:"",clearSearch:s.debounce(function(){this.searchQuery=""},350),searchKey(e){this.clearSearch(),this.searchQuery+=e;let t;for(let r in this.items)if(this.items[r].el.textContent.trim().toLowerCase().startsWith(this.searchQuery)){t=this.items[r].key;break}if(this.nonDisabledOrderedKeys.includes(t))return t},activateByKeyEvent(e,t=!1,r=()=>!1,i=()=>{},n){let a,c;n(!0);let o=!0;switch(e.key){case["ArrowDown","ArrowRight"][d==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),n(!1),!r()){i();break}this.reorderKeys(),c=this.hasActive(),a=c?this.nextKey():this.firstKey();break;case["ArrowUp","ArrowLeft"][d==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),n(!1),!r()){i();break}this.reorderKeys(),c=this.hasActive(),a=c?this.prevKey():this.lastKey();break;case"Home":case"PageUp":if(e.key=="Home"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),n(!1),this.reorderKeys(),c=this.hasActive(),a=this.firstKey();break;case"End":case"PageDown":if(e.key=="End"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),n(!1),this.reorderKeys(),c=this.hasActive(),a=this.lastKey();break;default:o=this.activatedByKeyPress,t&&e.key.length===1&&(a=this.searchKey(e.key));break}a&&this.activateAndScrollToKey(a,o)}}}function K(s,h,d,l){let e=y(d,l);e.forEach(i=>i._x_hiddenInput=!0),e.forEach(i=>i._x_ignore=!0);let t=h.children,r=[];for(let i=0;i<t.length;i++){let n=t[i];if(n._x_hiddenInput)r.push(n);else break}s.mutateDom(()=>{r.forEach(i=>i.remove()),e.reverse().forEach(i=>h.prepend(i))})}function y(s,h,d=[]){if(u(h))for(let l in h)d=d.concat(y(`${s}[${l}]`,h[l]));else{let l=document.createElement("input");return l.setAttribute("type","hidden"),l.setAttribute("name",s),l.setAttribute("value",""+h),[l]}return d}function u(s){return typeof s=="object"&&s!==null}export{f as a,K as b};
