(()=>{function d(i,a,t,s){return{items:[],activeKey:b(i),orderedKeys:[],activatedByKeyPress:!1,activateSelectedOrFirst:i.debounce(function(){s(!1)}),registerItemsQueue:[],registerItem(e,r,l,n){this.registerItemsQueue.length===0&&queueMicrotask(()=>{this.registerItemsQueue.length>0&&(this.items=this.items.concat(this.registerItemsQueue),this.registerItemsQueue=[],this.reorderKeys(),this.activateSelectedOrFirst())});let o={key:e,el:r,value:l,disabled:n};this.registerItemsQueue.push(o)},unregisterKeysQueue:[],unregisterItem(e){this.unregisterKeysQueue.length===0&&queueMicrotask(()=>{this.unregisterKeysQueue.length>0&&(this.items=this.items.filter(r=>!this.unregisterKeysQueue.includes(r.key)),this.orderedKeys=this.orderedKeys.filter(r=>!this.unregisterKeysQueue.includes(r)),this.unregisterKeysQueue=[],this.reorderKeys(),this.activateSelectedOrFirst())}),this.unregisterKeysQueue.push(e)},getItemByKey(e){return this.items.find(r=>r.key===e)},getItemByValue(e){return this.items.find(r=>i.raw(r.value)===i.raw(e))},getItemByEl(e){return this.items.find(r=>r.el===e)},getItemsByValues(e){let r=e.map(n=>i.raw(n)),l=this.items.filter(n=>r.includes(i.raw(n.value)));return l=l.slice().sort((n,o)=>{let u=n.el.compareDocumentPosition(o.el);return u&Node.DOCUMENT_POSITION_FOLLOWING?-1:u&Node.DOCUMENT_POSITION_PRECEDING?1:0}),l},getActiveItem(){if(!this.hasActive())return null;let e=this.items.find(r=>r.key===this.activeKey.get());return e||this.deactivateKey(this.activeKey.get()),e},activateItem(e){e&&this.activateKey(e.key)},reorderKeys:i.debounce(function(){this.orderedKeys=this.items.map(e=>e.key),this.orderedKeys=this.orderedKeys.slice().sort((e,r)=>{if(e===null||r===null)return 0;let l=this.items.find(u=>u.key===e).el,n=this.items.find(u=>u.key===r).el,o=l.compareDocumentPosition(n);return o&Node.DOCUMENT_POSITION_FOLLOWING?-1:o&Node.DOCUMENT_POSITION_PRECEDING?1:0}),this.orderedKeys.includes(this.activeKey.get())||this.deactivateKey(this.activeKey.get())}),getActiveKey(){return this.activeKey.get()},activeEl(){if(this.activeKey.get())return this.items.find(e=>e.key===this.activeKey.get()).el},isActiveEl(e){let r=this.items.find(l=>l.el===e);return this.activeKey.is(r)},activateEl(e){let r=this.items.find(l=>l.el===e);this.activateKey(r.key)},isDisabledEl(e){return this.items.find(r=>r.el===e).disabled},get isScrollingTo(){return this.scrollingCount>0},scrollingCount:0,activateAndScrollToKey(e,r){if(!this.getItemByKey(e))return;this.scrollingCount++,this.activateKey(e,r),this.items.find(n=>n.key===e).el.scrollIntoView({block:"nearest"}),setTimeout(()=>{this.scrollingCount--},25)},isDisabled(e){let r=this.items.find(l=>l.key===e);return r?r.disabled:!1},get nonDisabledOrderedKeys(){return this.orderedKeys.filter(e=>!this.isDisabled(e))},hasActive(){return!!this.activeKey.get()},wasActivatedByKeyPress(){return this.activatedByKeyPress},isActiveKey(e){return this.activeKey.is(e)},activateKey(e,r=!1){this.isDisabled(e)||(this.activeKey.set(e),this.activatedByKeyPress=r)},deactivateKey(e){this.activeKey.get()===e&&(this.activeKey.set(null),this.activatedByKeyPress=!1)},deactivate(){this.activeKey.get()&&(this.isScrollingTo||(this.activeKey.set(null),this.activatedByKeyPress=!1))},nextKey(){if(!this.activeKey.get())return;let e=this.nonDisabledOrderedKeys.findIndex(r=>r===this.activeKey.get());return this.nonDisabledOrderedKeys[e+1]},prevKey(){if(!this.activeKey.get())return;let e=this.nonDisabledOrderedKeys.findIndex(r=>r===this.activeKey.get());return this.nonDisabledOrderedKeys[e-1]},firstKey(){return this.nonDisabledOrderedKeys[0]},lastKey(){return this.nonDisabledOrderedKeys[this.nonDisabledOrderedKeys.length-1]},searchQuery:"",clearSearch:i.debounce(function(){this.searchQuery=""},350),searchKey(e){this.clearSearch(),this.searchQuery+=e;let r;for(let l in this.items)if(this.items[l].el.textContent.trim().toLowerCase().startsWith(this.searchQuery)){r=this.items[l].key;break}if(this.nonDisabledOrderedKeys.includes(r))return r},activateByKeyEvent(e,r=!1,l=()=>!1,n=()=>{},o){let u,_;o(!0);let h=!0;switch(e.key){case["ArrowDown","ArrowRight"][t==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),o(!1),!l()){n();break}this.reorderKeys(),_=this.hasActive(),u=_?this.nextKey():this.firstKey();break;case["ArrowUp","ArrowLeft"][t==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),o(!1),!l()){n();break}this.reorderKeys(),_=this.hasActive(),u=_?this.prevKey():this.lastKey();break;case"Home":case"PageUp":if(e.key=="Home"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),o(!1),this.reorderKeys(),_=this.hasActive(),u=this.firstKey();break;case"End":case"PageDown":if(e.key=="End"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),o(!1),this.reorderKeys(),_=this.hasActive(),u=this.lastKey();break;default:h=this.activatedByKeyPress,r&&e.key.length===1&&(u=this.searchKey(e.key));break}u&&this.activateAndScrollToKey(u,h)}}}function c(i,a,t,s){let e=f(t,s);e.forEach(n=>n._x_hiddenInput=!0),e.forEach(n=>n._x_ignore=!0);let r=a.children,l=[];for(let n=0;n<r.length;n++){let o=r[n];if(o._x_hiddenInput)l.push(o);else break}i.mutateDom(()=>{l.forEach(n=>n.remove()),e.reverse().forEach(n=>a.prepend(n))})}function f(i,a,t=[]){if(v(a))for(let s in a)t=t.concat(f(`${i}[${s}]`,a[s]));else{let s=document.createElement("input");return s.setAttribute("type","hidden"),s.setAttribute("name",i),s.setAttribute("value",""+a),[s]}return t}function v(i){return typeof i=="object"&&i!==null}function b(i,a){let t={},s,e=i.reactive({state:!1}),r=()=>(e.state,s),l=o=>{o!==s&&(s!==void 0&&(t[s].state=!1),s=o,t[o]===void 0?t[o]=i.reactive({state:!0}):t[o].state=!0,e.state=!e.state)},n=o=>t[o]===void 0?(t[o]=i.reactive({state:!1}),t[o].state):!!t[o].state;return a===void 0||l(a),{get:r,set:l,is:n}}function y(i){i.directive("combobox",(a,t,{evaluate:s})=>{t.value==="input"?g(a,i):t.value==="button"?x(a,i):t.value==="label"?K(a,i):t.value==="options"?$(a,i):t.value==="option"?I(a,i,t,s):m(a,i)}).before("bind"),i.magic("combobox",a=>{let t=i.$data(a);return{get value(){return t.__value},get isOpen(){return t.__isOpen},get isDisabled(){return t.__isDisabled},get activeOption(){let s=t.__context?.getActiveItem();return s&&s.value},get activeIndex(){let s=t.__context?.getActiveItem();return s?Object.values(i.raw(t.__context.items)).findIndex(e=>i.raw(s)==i.raw(e)):null}}}),i.magic("comboboxOption",a=>{let t=i.$data(a),s=i.findClosest(a,e=>e.hasAttribute("x-combobox:option"));if(!s)throw"No x-combobox:option directive found...";return{get isActive(){return t.__context.isActiveKey(i.$data(s).__optionKey)},get isSelected(){return t.__isSelected(s)},get isDisabled(){return t.__context.isDisabled(i.$data(s).__optionKey)}}})}function m(i,a){a.bind(i,{"x-id"(){return["alpine-combobox-button","alpine-combobox-options","alpine-combobox-label"]},"x-modelable":"__value","x-data"(){return{__ready:!1,__value:null,__isOpen:!1,__context:void 0,__isMultiple:void 0,__isStatic:!1,__isDisabled:void 0,__displayValue:void 0,__compareBy:null,__inputName:null,__isTyping:!1,__hold:!1,init(){this.__isMultiple=a.extractProp(i,"multiple",!1),this.__isDisabled=a.extractProp(i,"disabled",!1),this.__inputName=a.extractProp(i,"name",null),this.__nullable=a.extractProp(i,"nullable",!1),this.__compareBy=a.extractProp(i,"by"),this.__context=d(a,this.__isMultiple,"vertical",()=>this.__activateSelectedOrFirst());let t=a.extractProp(i,"default-value",this.__isMultiple?[]:null);this.__value=t,queueMicrotask(()=>{a.effect(()=>{this.__inputName&&c(a,this.$el,this.__inputName,this.__value)}),a.effect(()=>!this.__isMultiple&&this.__resetInput())})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let t=this.$refs.__input;if(!t)return;let s=this.__getCurrentValue();t.value=s},__getCurrentValue(){return!this.$refs.__input||!this.__value?"":this.__displayValue?this.__displayValue(this.__value):typeof this.__value=="string"?this.__value:""},__open(){if(this.__isOpen)return;this.__isOpen=!0;let t=this.$refs.__input;if(t){let e=t.value,{selectionStart:r,selectionEnd:l,selectionDirection:n}=t;t.value="",t.dispatchEvent(new Event("change")),t.value=e,n!==null?t.setSelectionRange(r,l,n):t.setSelectionRange(r,l)}(e=>requestAnimationFrame(()=>requestAnimationFrame(e)))(()=>{this.$refs.__input.focus({preventScroll:!0}),this.__activateSelectedOrFirst()})},__close(){this.__isOpen=!1,this.__context.deactivate()},__activateSelectedOrFirst(t=!0){if(!this.__isOpen||this.__context.hasActive()&&this.__context.wasActivatedByKeyPress())return;let s;if(this.__isMultiple){let r=this.__context.getItemsByValues(this.__value);s=r.length?r[0].value:null}else s=this.__value;let e=null;if(t&&s&&(e=this.__context.getItemByValue(s)),e){this.__context.activateAndScrollToKey(e.key);return}this.__context.activateAndScrollToKey(this.__context.firstKey())},__selectActive(){let t=this.__context.getActiveItem();t&&this.__toggleSelected(t.value)},__selectOption(t){let s=this.__context.getItemByEl(t);s&&this.__toggleSelected(s.value)},__isSelected(t){let s=this.__context.getItemByEl(t);return!s||!s.value?!1:this.__hasSelected(s.value)},__toggleSelected(t){if(!this.__isMultiple){this.__value=t;return}let s=this.__value.findIndex(e=>this.__compare(e,t));s===-1?this.__value.push(t):this.__value.splice(s,1)},__hasSelected(t){return this.__isMultiple?this.__value.some(s=>this.__compare(s,t)):this.__compare(this.__value,t)},__compare(t,s){let e=this.__compareBy;if(e||(e=(r,l)=>a.raw(r)===a.raw(l)),typeof e=="string"){let r=e;e=(l,n)=>!l||typeof l!="object"||!n||typeof n!="object"?a.raw(l)===a.raw(n):l[r]===n[r]}return e(t,s)}}},"@mousedown.window"(t){!this.$refs.__input.contains(t.target)&&!this.$refs.__button.contains(t.target)&&!this.$refs.__options.contains(t.target)&&(this.__close(),this.__resetInput())}})}function g(i,a){a.bind(i,{"x-ref":"__input",":id"(){return this.$id("alpine-combobox-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list",async":aria-controls"(){return await p(()=>this.$refs.__options&&this.$refs.__options.id)},":aria-expanded"(){return this.$data.__isDisabled?void 0:this.$data.__isOpen},":aria-multiselectable"(){return this.$data.__isMultiple?!0:void 0},":aria-activedescendant"(){if(!this.$data.__context.hasActive())return;let t=this.$data.__context.getActiveItem();return t?t.el.id:null},":aria-labelledby"(){return this.$refs.__label?this.$refs.__label.id:this.$refs.__button?this.$refs.__button.id:null},"x-init"(){let t=a.extractProp(this.$el,"display-value");t&&(this.$data.__displayValue=t)},"@input.stop"(t){this.$data.__isTyping&&(this.$data.__open(),this.$dispatch("change"))},"@blur"(){this.$data.__stopTyping(!1)},"@keydown"(t){queueMicrotask(()=>this.$data.__context.activateByKeyEvent(t,!1,()=>this.$data.__isOpen,()=>this.$data.__open(),s=>this.$data.__isTyping=s))},"@keydown.enter.prevent.stop"(){this.$data.__selectActive(),this.$data.__stopTyping(),this.$data.__isMultiple||(this.$data.__close(),this.$data.__resetInput())},"@keydown.escape.prevent"(t){this.$data.__static||t.stopPropagation(),this.$data.__stopTyping(),this.$data.__close(),this.$data.__resetInput()},"@keydown.tab"(){this.$data.__stopTyping(),this.$data.__isOpen&&this.$data.__close(),this.$data.__resetInput()},"@keydown.backspace"(t){if(this.$data.__isMultiple||!this.$data.__nullable)return;let s=t.target;requestAnimationFrame(()=>{if(s.value===""){this.$data.__value=null;let e=this.$refs.__options;e&&(e.scrollTop=0),this.$data.__context.deactivate()}})}})}function x(i,a){a.bind(i,{"x-ref":"__button",":id"(){return this.$id("alpine-combobox-button")},"aria-haspopup":"true",async":aria-controls"(){return await p(()=>this.$refs.__options&&this.$refs.__options.id)},":aria-labelledby"(){return this.$refs.__label?[this.$refs.__label.id,this.$el.id].join(" "):null},":aria-expanded"(){return this.$data.__isDisabled?null:this.$data.__isOpen},":disabled"(){return this.$data.__isDisabled},tabindex:"-1","x-init"(){this.$el.tagName.toLowerCase()==="button"&&!this.$el.hasAttribute("type")&&(this.$el.type="button")},"@click"(t){this.$data.__isDisabled||(this.$data.__isOpen?(this.$data.__close(),this.$data.__resetInput()):(t.preventDefault(),this.$data.__open()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function K(i,a){a.bind(i,{"x-ref":"__label",":id"(){return this.$id("alpine-combobox-label")},"@click"(){this.$refs.__input.focus({preventScroll:!0})}})}function $(i,a){a.bind(i,{"x-ref":"__options",":id"(){return this.$id("alpine-combobox-options")},role:"listbox",":aria-labelledby"(){return this.$refs.__label?this.$refs.__label.id:this.$refs.__button?this.$refs.__button.id:null},"x-init"(){this.$data.__isStatic=a.bound(this.$el,"static",!1),a.bound(this.$el,"hold")&&(this.$data.__hold=!0)},"x-show"(){return this.$data.__isStatic?!0:this.$data.__isOpen}})}function I(i,a){a.bind(i,{"x-id"(){return["alpine-combobox-option"]},":id"(){return this.$id("alpine-combobox-option")},role:"option",":tabindex"(){return this.$comboboxOption.isDisabled?void 0:"-1"},"x-effect"(){this.$comboboxOption.isSelected?i.setAttribute("aria-selected",!0):i.setAttribute("aria-selected",!1)},":aria-disabled"(){return this.$comboboxOption.isDisabled},"x-data"(){return{__optionKey:null,init(){this.__optionKey=(Math.random()+1).toString(36).substring(7);let t=a.extractProp(this.$el,"value"),s=a.extractProp(this.$el,"disabled",!1,!1);this.__context.registerItem(this.__optionKey,this.$el,t,s)},destroy(){this.__context.unregisterItem(this.__optionKey)}}},"@click"(){this.$comboboxOption.isDisabled||(this.__selectOption(this.$el),this.__isMultiple||(this.__close(),this.__resetInput()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0})))},"@mouseenter"(t){this.__context.activateEl(this.$el)},"@mousemove"(t){this.__context.isActiveEl(this.$el)||this.__context.activateEl(this.$el)},"@mouseleave"(t){this.__hold||this.__context.deactivate()}})}function p(i){return new Promise(a=>queueMicrotask(()=>a(i())))}window.addEventListener("alpine:init",()=>{window.Alpine.plugin(y)});})();
