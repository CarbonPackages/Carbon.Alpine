(()=>{function h(s,r,t,a){return{items:[],activeKey:null,orderedKeys:[],activatedByKeyPress:!1,activateSelectedOrFirst:s.debounce(function(){a(!1)}),registerItem(e,i,n,l){this.items.push({key:e,el:i,value:n,disabled:l}),this.orderedKeys.push(e),this.reorderKeys(),this.activateSelectedOrFirst()},unregisterItem(e){let i=this.items.findIndex(n=>n.key===e);i!==-1&&this.items.splice(i,1),i=this.orderedKeys.indexOf(e),i!==-1&&this.orderedKeys.splice(i,1),this.reorderKeys(),this.activateSelectedOrFirst()},getItemByKey(e){return this.items.find(i=>i.key===e)},getItemByValue(e){return this.items.find(i=>s.raw(i.value)===s.raw(e))},getItemByEl(e){return this.items.find(i=>i.el===e)},getItemsByValues(e){let i=e.map(l=>s.raw(l)),n=this.items.filter(l=>i.includes(s.raw(l.value)));return n=n.slice().sort((l,_)=>{let o=l.el.compareDocumentPosition(_.el);return o&Node.DOCUMENT_POSITION_FOLLOWING?-1:o&Node.DOCUMENT_POSITION_PRECEDING?1:0}),n},getActiveItem(){if(!this.hasActive())return null;let e=this.items.find(i=>i.key===this.activeKey);return e||this.deactivateKey(this.activeKey),e},activateItem(e){e&&this.activateKey(e.key)},reorderKeys:s.debounce(function(){this.orderedKeys=this.items.map(e=>e.key),this.orderedKeys=this.orderedKeys.slice().sort((e,i)=>{if(e===null||i===null)return 0;let n=this.items.find(o=>o.key===e).el,l=this.items.find(o=>o.key===i).el,_=n.compareDocumentPosition(l);return _&Node.DOCUMENT_POSITION_FOLLOWING?-1:_&Node.DOCUMENT_POSITION_PRECEDING?1:0}),this.orderedKeys.includes(this.activeKey)||this.deactivateKey(this.activeKey)}),activeEl(){if(this.activeKey)return this.items.find(e=>e.key===this.activeKey).el},isActiveEl(e){let i=this.items.find(n=>n.el===e);return this.activeKey===i},activateEl(e){let i=this.items.find(n=>n.el===e);this.activateKey(i.key)},isDisabledEl(e){return this.items.find(i=>i.el===e).disabled},get isScrollingTo(){return this.scrollingCount>0},scrollingCount:0,activateAndScrollToKey(e,i){if(!this.getItemByKey(e))return;this.scrollingCount++,this.activateKey(e,i),this.items.find(l=>l.key===e).el.scrollIntoView({block:"nearest"}),setTimeout(()=>{this.scrollingCount--},25)},isDisabled(e){let i=this.items.find(n=>n.key===e);return i?i.disabled:!1},get nonDisabledOrderedKeys(){return this.orderedKeys.filter(e=>!this.isDisabled(e))},hasActive(){return!!this.activeKey},wasActivatedByKeyPress(){return this.activatedByKeyPress},isActiveKey(e){return this.activeKey===e},activateKey(e,i=!1){this.isDisabled(e)||(this.activeKey=e,this.activatedByKeyPress=i)},deactivateKey(e){this.activeKey===e&&(this.activeKey=null,this.activatedByKeyPress=!1)},deactivate(){this.activeKey&&(this.isScrollingTo||(this.activeKey=null,this.activatedByKeyPress=!1))},nextKey(){if(!this.activeKey)return;let e=this.nonDisabledOrderedKeys.findIndex(i=>i===this.activeKey);return this.nonDisabledOrderedKeys[e+1]},prevKey(){if(!this.activeKey)return;let e=this.nonDisabledOrderedKeys.findIndex(i=>i===this.activeKey);return this.nonDisabledOrderedKeys[e-1]},firstKey(){return this.nonDisabledOrderedKeys[0]},lastKey(){return this.nonDisabledOrderedKeys[this.nonDisabledOrderedKeys.length-1]},searchQuery:"",clearSearch:s.debounce(function(){this.searchQuery=""},350),searchKey(e){this.clearSearch(),this.searchQuery+=e;let i;for(let n in this.items)if(this.items[n].el.textContent.trim().toLowerCase().startsWith(this.searchQuery)){i=this.items[n].key;break}if(this.nonDisabledOrderedKeys.includes(i))return i},activateByKeyEvent(e,i=!1,n=()=>!1,l=()=>{},_){let o,u;_(!0);let d=!0;switch(e.key){case["ArrowDown","ArrowRight"][t==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),_(!1),!n()){l();break}this.reorderKeys(),u=this.hasActive(),o=u?this.nextKey():this.firstKey();break;case["ArrowUp","ArrowLeft"][t==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),_(!1),!n()){l();break}this.reorderKeys(),u=this.hasActive(),o=u?this.prevKey():this.lastKey();break;case"Home":case"PageUp":if(e.key=="Home"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),_(!1),this.reorderKeys(),u=this.hasActive(),o=this.firstKey();break;case"End":case"PageDown":if(e.key=="End"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),_(!1),this.reorderKeys(),u=this.hasActive(),o=this.lastKey();break;default:d=this.activatedByKeyPress,i&&e.key.length===1&&(o=this.searchKey(e.key));break}o&&this.activateAndScrollToKey(o,d)}}}function c(s,r,t,a){let e=f(t,a);e.forEach(l=>l._x_hiddenInput=!0),e.forEach(l=>l._x_ignore=!0);let i=r.children,n=[];for(let l=0;l<i.length;l++){let _=i[l];if(_._x_hiddenInput)n.push(_);else break}s.mutateDom(()=>{n.forEach(l=>l.remove()),e.reverse().forEach(l=>r.prepend(l))})}function f(s,r,t=[]){if(v(r))for(let a in r)t=t.concat(f(`${s}[${a}]`,r[a]));else{let a=document.createElement("input");return a.setAttribute("type","hidden"),a.setAttribute("name",s),a.setAttribute("value",""+r),[a]}return t}function v(s){return typeof s=="object"&&s!==null}function y(s){s.directive("combobox",(r,t,{evaluate:a})=>{t.value==="input"?m(r,s):t.value==="button"?x(r,s):t.value==="label"?$(r,s):t.value==="options"?K(r,s):t.value==="option"?g(r,s,t,a):b(r,s)}).before("bind"),s.magic("combobox",r=>{let t=s.$data(r);return{get value(){return t.__value},get isOpen(){return t.__isOpen},get isDisabled(){return t.__isDisabled},get activeOption(){let a=t.__context?.getActiveItem();return a&&a.value},get activeIndex(){let a=t.__context?.getActiveItem();return a?Object.values(s.raw(t.__context.items)).findIndex(e=>s.raw(a)==s.raw(e)):null}}}),s.magic("comboboxOption",r=>{let t=s.$data(r),a=s.findClosest(r,e=>e.__optionKey);if(!a)throw"No x-combobox:option directive found...";return{get isActive(){return t.__context.isActiveKey(a.__optionKey)},get isSelected(){return t.__isSelected(a)},get isDisabled(){return t.__context.isDisabled(a.__optionKey)}}})}function b(s,r){r.bind(s,{"x-id"(){return["alpine-combobox-button","alpine-combobox-options","alpine-combobox-label"]},"x-modelable":"__value","x-data"(){return{__ready:!1,__value:null,__isOpen:!1,__context:void 0,__isMultiple:void 0,__isStatic:!1,__isDisabled:void 0,__displayValue:void 0,__compareBy:null,__inputName:null,__isTyping:!1,__hold:!1,init(){this.__isMultiple=r.extractProp(s,"multiple",!1),this.__isDisabled=r.extractProp(s,"disabled",!1),this.__inputName=r.extractProp(s,"name",null),this.__nullable=r.extractProp(s,"nullable",!1),this.__compareBy=r.extractProp(s,"by"),this.__context=h(r,this.__isMultiple,"vertical",()=>this.__activateSelectedOrFirst());let t=r.extractProp(s,"default-value",this.__isMultiple?[]:null);this.__value=t,queueMicrotask(()=>{r.effect(()=>{this.__inputName&&c(r,this.$el,this.__inputName,this.__value)})})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let t=this.$refs.__input;if(!t)return;let a=this.__getCurrentValue();t.value=a},__getCurrentValue(){return!this.$refs.__input||!this.__value?"":this.__displayValue?this.__displayValue(this.__value):typeof this.__value=="string"?this.__value:""},__open(){if(this.__isOpen)return;this.__isOpen=!0;let t=this.$refs.__input;if(t){let e=t.value,{selectionStart:i,selectionEnd:n,selectionDirection:l}=t;t.value="",t.dispatchEvent(new Event("change")),t.value=e,l!==null?t.setSelectionRange(i,n,l):t.setSelectionRange(i,n)}(e=>requestAnimationFrame(()=>requestAnimationFrame(e)))(()=>{this.$refs.__input.focus({preventScroll:!0}),this.__activateSelectedOrFirst()})},__close(){this.__isOpen=!1,this.__context.deactivate()},__activateSelectedOrFirst(t=!0){if(!this.__isOpen||this.__context.hasActive()&&this.__context.wasActivatedByKeyPress())return;let a;if(this.__isMultiple){let i=this.__context.getItemsByValues(this.__value);a=i.length?i[0].value:null}else a=this.__value;let e=null;if(t&&a&&(e=this.__context.getItemByValue(a)),e){this.__context.activateAndScrollToKey(e.key);return}this.__context.activateAndScrollToKey(this.__context.firstKey())},__selectActive(){let t=this.__context.getActiveItem();t&&this.__toggleSelected(t.value)},__selectOption(t){let a=this.__context.getItemByEl(t);a&&this.__toggleSelected(a.value)},__isSelected(t){let a=this.__context.getItemByEl(t);return!a||!a.value?!1:this.__hasSelected(a.value)},__toggleSelected(t){if(!this.__isMultiple){this.__value=t;return}let a=this.__value.findIndex(e=>this.__compare(e,t));a===-1?this.__value.push(t):this.__value.splice(a,1)},__hasSelected(t){return this.__isMultiple?this.__value.some(a=>this.__compare(a,t)):this.__compare(this.__value,t)},__compare(t,a){let e=this.__compareBy;if(e||(e=(i,n)=>r.raw(i)===r.raw(n)),typeof e=="string"){let i=e;e=(n,l)=>!n||typeof n!="object"||!l||typeof l!="object"?r.raw(n)===r.raw(l):n[i]===l[i]}return e(t,a)}}},"@mousedown.window"(t){!this.$refs.__input.contains(t.target)&&!this.$refs.__button.contains(t.target)&&!this.$refs.__options.contains(t.target)&&(this.__close(),this.__resetInput())}})}function m(s,r){r.bind(s,{"x-ref":"__input",":id"(){return this.$id("alpine-combobox-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list",async":aria-controls"(){return await p(()=>this.$refs.__options&&this.$refs.__options.id)},":aria-expanded"(){return this.$data.__isDisabled?void 0:this.$data.__isOpen},":aria-multiselectable"(){return this.$data.__isMultiple?!0:void 0},":aria-activedescendant"(){if(!this.$data.__context.hasActive())return;let t=this.$data.__context.getActiveItem();return t?t.el.id:null},":aria-labelledby"(){return this.$refs.__label?this.$refs.__label.id:this.$refs.__button?this.$refs.__button.id:null},"x-init"(){let t=r.extractProp(this.$el,"display-value");t&&(this.$data.__displayValue=t)},"@input.stop"(t){this.$data.__isTyping&&(this.$data.__open(),this.$dispatch("change"))},"@blur"(){this.$data.__stopTyping(!1)},"@keydown"(t){queueMicrotask(()=>this.$data.__context.activateByKeyEvent(t,!1,()=>this.$data.__isOpen,()=>this.$data.__open(),a=>this.$data.__isTyping=a))},"@keydown.enter.prevent.stop"(){this.$data.__selectActive(),this.$data.__stopTyping(),this.$data.__isMultiple||(this.$data.__close(),this.$data.__resetInput())},"@keydown.escape.prevent"(t){this.$data.__static||t.stopPropagation(),this.$data.__stopTyping(),this.$data.__close(),this.$data.__resetInput()},"@keydown.tab"(){this.$data.__stopTyping(),this.$data.__isOpen&&this.$data.__close(),this.$data.__resetInput()},"@keydown.backspace"(t){if(this.$data.__isMultiple||!this.$data.__nullable)return;let a=t.target;requestAnimationFrame(()=>{if(a.value===""){this.$data.__value=null;let e=this.$refs.__options;e&&(e.scrollTop=0),this.$data.__context.deactivate()}})}})}function x(s,r){r.bind(s,{"x-ref":"__button",":id"(){return this.$id("alpine-combobox-button")},"aria-haspopup":"true",async":aria-controls"(){return await p(()=>this.$refs.__options&&this.$refs.__options.id)},":aria-labelledby"(){return this.$refs.__label?[this.$refs.__label.id,this.$el.id].join(" "):null},":aria-expanded"(){return this.$data.__isDisabled?null:this.$data.__isOpen},":disabled"(){return this.$data.__isDisabled},tabindex:"-1","x-init"(){this.$el.tagName.toLowerCase()==="button"&&!this.$el.hasAttribute("type")&&(this.$el.type="button")},"@click"(t){this.$data.__isDisabled||(this.$data.__isOpen?(this.$data.__close(),this.$data.__resetInput()):(t.preventDefault(),this.$data.__open()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function $(s,r){r.bind(s,{"x-ref":"__label",":id"(){return this.$id("alpine-combobox-label")},"@click"(){this.$refs.__input.focus({preventScroll:!0})}})}function K(s,r){r.bind(s,{"x-ref":"__options",":id"(){return this.$id("alpine-combobox-options")},role:"listbox",":aria-labelledby"(){return this.$refs.__label?this.$refs.__label.id:this.$refs.__button?this.$refs.__button.id:null},"x-init"(){this.$data.__isStatic=r.bound(this.$el,"static",!1),r.bound(this.$el,"hold")&&(this.$data.__hold=!0)},"x-show"(){return this.$data.__isStatic?!0:this.$data.__isOpen}})}function g(s,r){r.bind(s,{"x-id"(){return["alpine-combobox-option"]},":id"(){return this.$id("alpine-combobox-option")},role:"option",":tabindex"(){return this.$comboboxOption.isDisabled?void 0:"-1"},"x-effect"(){this.$comboboxOption.isSelected?s.setAttribute("aria-selected",!0):s.setAttribute("aria-selected",!1)},":aria-disabled"(){return this.$comboboxOption.isDisabled},"x-data"(){return{init(){let t=this.$el.__optionKey=(Math.random()+1).toString(36).substring(7),a=r.extractProp(this.$el,"value"),e=r.extractProp(this.$el,"disabled",!1,!1);this.__context.registerItem(t,this.$el,a,e)},destroy(){this.__context.unregisterItem(this.$el.__optionKey)}}},"@click"(){this.$comboboxOption.isDisabled||(this.__selectOption(this.$el),this.__isMultiple||(this.__close(),this.__resetInput()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0})))},"@mouseenter"(t){this.__context.activateEl(this.$el)},"@mousemove"(t){this.__context.isActiveEl(this.$el)||this.__context.activateEl(this.$el)},"@mouseleave"(t){this.__hold||this.__context.deactivate()}})}function p(s){return new Promise(r=>queueMicrotask(()=>r(s())))}window.addEventListener("alpine:init",()=>{window.Alpine.plugin(y)});})();
