(()=>{function h(s,a,t,i){return{items:[],activeKey:p(s),orderedKeys:[],activatedByKeyPress:!1,activateSelectedOrFirst:s.debounce(function(){i(!1)}),registerItemsQueue:[],registerItem(e,r,l,n){this.registerItemsQueue.length===0&&queueMicrotask(()=>{this.registerItemsQueue.length>0&&(this.items=this.items.concat(this.registerItemsQueue),this.registerItemsQueue=[],this.reorderKeys(),this.activateSelectedOrFirst())});let o={key:e,el:r,value:l,disabled:n};this.registerItemsQueue.push(o)},unregisterKeysQueue:[],unregisterItem(e){this.unregisterKeysQueue.length===0&&queueMicrotask(()=>{this.unregisterKeysQueue.length>0&&(this.items=this.items.filter(r=>!this.unregisterKeysQueue.includes(r.key)),this.orderedKeys=this.orderedKeys.filter(r=>!this.unregisterKeysQueue.includes(r)),this.unregisterKeysQueue=[],this.reorderKeys(),this.activateSelectedOrFirst())}),this.unregisterKeysQueue.push(e)},getItemByKey(e){return this.items.find(r=>r.key===e)},getItemByValue(e){return this.items.find(r=>s.raw(r.value)===s.raw(e))},getItemByEl(e){return this.items.find(r=>r.el===e)},getItemsByValues(e){let r=e.map(n=>s.raw(n)),l=this.items.filter(n=>r.includes(s.raw(n.value)));return l=l.slice().sort((n,o)=>{let u=n.el.compareDocumentPosition(o.el);return u&Node.DOCUMENT_POSITION_FOLLOWING?-1:u&Node.DOCUMENT_POSITION_PRECEDING?1:0}),l},getActiveItem(){if(!this.hasActive())return null;let e=this.items.find(r=>r.key===this.activeKey.get());return e||this.deactivateKey(this.activeKey.get()),e},activateItem(e){e&&this.activateKey(e.key)},reorderKeys:s.debounce(function(){this.orderedKeys=this.items.map(e=>e.key),this.orderedKeys=this.orderedKeys.slice().sort((e,r)=>{if(e===null||r===null)return 0;let l=this.items.find(u=>u.key===e).el,n=this.items.find(u=>u.key===r).el,o=l.compareDocumentPosition(n);return o&Node.DOCUMENT_POSITION_FOLLOWING?-1:o&Node.DOCUMENT_POSITION_PRECEDING?1:0}),this.orderedKeys.includes(this.activeKey.get())||this.deactivateKey(this.activeKey.get())}),getActiveKey(){return this.activeKey.get()},activeEl(){if(this.activeKey.get())return this.items.find(e=>e.key===this.activeKey.get()).el},isActiveEl(e){let r=this.items.find(l=>l.el===e);return this.activeKey.is(r)},activateEl(e){let r=this.items.find(l=>l.el===e);this.activateKey(r.key)},isDisabledEl(e){return this.items.find(r=>r.el===e).disabled},get isScrollingTo(){return this.scrollingCount>0},scrollingCount:0,activateAndScrollToKey(e,r){if(!this.getItemByKey(e))return;this.scrollingCount++,this.activateKey(e,r),this.items.find(n=>n.key===e).el.scrollIntoView({block:"nearest"}),setTimeout(()=>{this.scrollingCount--},25)},isDisabled(e){let r=this.items.find(l=>l.key===e);return r?r.disabled:!1},get nonDisabledOrderedKeys(){return this.orderedKeys.filter(e=>!this.isDisabled(e))},hasActive(){return!!this.activeKey.get()},wasActivatedByKeyPress(){return this.activatedByKeyPress},isActiveKey(e){return this.activeKey.is(e)},activateKey(e,r=!1){this.isDisabled(e)||(this.activeKey.set(e),this.activatedByKeyPress=r)},deactivateKey(e){this.activeKey.get()===e&&(this.activeKey.set(null),this.activatedByKeyPress=!1)},deactivate(){this.activeKey.get()&&(this.isScrollingTo||(this.activeKey.set(null),this.activatedByKeyPress=!1))},nextKey(){if(!this.activeKey.get())return;let e=this.nonDisabledOrderedKeys.findIndex(r=>r===this.activeKey.get());return this.nonDisabledOrderedKeys[e+1]},prevKey(){if(!this.activeKey.get())return;let e=this.nonDisabledOrderedKeys.findIndex(r=>r===this.activeKey.get());return this.nonDisabledOrderedKeys[e-1]},firstKey(){return this.nonDisabledOrderedKeys[0]},lastKey(){return this.nonDisabledOrderedKeys[this.nonDisabledOrderedKeys.length-1]},searchQuery:"",clearSearch:s.debounce(function(){this.searchQuery=""},350),searchKey(e){this.clearSearch(),this.searchQuery+=e;let r;for(let l in this.items)if(this.items[l].el.textContent.trim().toLowerCase().startsWith(this.searchQuery)){r=this.items[l].key;break}if(this.nonDisabledOrderedKeys.includes(r))return r},activateByKeyEvent(e,r=!1,l=()=>!1,n=()=>{},o){let u,d;o(!0);let _=!0;switch(e.key){case["ArrowDown","ArrowRight"][t==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),o(!1),!l()){n();break}this.reorderKeys(),d=this.hasActive(),u=d?this.nextKey():this.firstKey();break;case["ArrowUp","ArrowLeft"][t==="vertical"?0:1]:if(e.preventDefault(),e.stopPropagation(),o(!1),!l()){n();break}this.reorderKeys(),d=this.hasActive(),u=d?this.prevKey():this.lastKey();break;case"Home":case"PageUp":if(e.key=="Home"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),o(!1),this.reorderKeys(),d=this.hasActive(),u=this.firstKey();break;case"End":case"PageDown":if(e.key=="End"&&e.shiftKey)return;e.preventDefault(),e.stopPropagation(),o(!1),this.reorderKeys(),d=this.hasActive(),u=this.lastKey();break;default:_=this.activatedByKeyPress,r&&e.key.length===1&&(u=this.searchKey(e.key));break}u&&this.activateAndScrollToKey(u,_)}}}function c(s,a,t,i){let e=f(t,i);e.forEach(n=>n._x_hiddenInput=!0),e.forEach(n=>n._x_ignore=!0);let r=a.children,l=[];for(let n=0;n<r.length;n++){let o=r[n];if(o._x_hiddenInput)l.push(o);else break}s.mutateDom(()=>{l.forEach(n=>n.remove()),e.reverse().forEach(n=>a.prepend(n))})}function f(s,a,t=[]){if(v(a))for(let i in a)t=t.concat(f(`${s}[${i}]`,a[i]));else{let i=document.createElement("input");return i.setAttribute("type","hidden"),i.setAttribute("name",s),i.setAttribute("value",""+a),[i]}return t}function v(s){return typeof s=="object"&&s!==null}function p(s,a){let t={},i,e=s.reactive({state:!1}),r=()=>(e.state,i),l=o=>{o!==i&&(i!==void 0&&(t[i].state=!1),i=o,t[o]===void 0?t[o]=s.reactive({state:!0}):t[o].state=!0,e.state=!e.state)},n=o=>t[o]===void 0?(t[o]=s.reactive({state:!1}),t[o].state):!!t[o].state;return a===void 0||l(a),{get:r,set:l,is:n}}function y(s){s.directive("listbox",(a,t)=>{t.value?t.value==="label"?K(a,s):t.value==="button"?b(a,s):t.value==="options"?m(a,s):t.value==="option"&&x(a,s):g(a,s)}).before("bind"),s.magic("listbox",a=>{let t=s.$data(a);return{get selected(){return t.__value},get active(){let i=t.__context.getActiveItem();return i&&i.value},get value(){return t.__value},get isOpen(){return t.__isOpen},get isDisabled(){return t.__isDisabled},get activeOption(){let i=t.__context.getActiveItem();return i&&i.value},get activeIndex(){let i=t.__context.getActiveItem();return i&&i.key}}}),s.magic("listboxOption",a=>{let t=s.$data(a),i=s.findClosest(a,e=>e.hasAttribute("x-listbox:option"));if(!i)throw"No x-listbox:option directive found...";return{get isActive(){return t.__context.isActiveKey(s.$data(i).__optionKey)},get isSelected(){return t.__isSelected(i)},get isDisabled(){return t.__context.isDisabled(s.$data(i).__optionKey)}}})}function g(s,a){a.bind(s,{"x-id"(){return["alpine-listbox-button","alpine-listbox-options","alpine-listbox-label"]},"x-modelable":"__value","x-data"(){return{__ready:!1,__value:null,__isOpen:!1,__context:void 0,__isMultiple:void 0,__isStatic:!1,__isDisabled:void 0,__compareBy:null,__inputName:null,__orientation:"vertical",__hold:!1,init(){this.__isMultiple=a.extractProp(s,"multiple",!1),this.__isDisabled=a.extractProp(s,"disabled",!1),this.__inputName=a.extractProp(s,"name",null),this.__compareBy=a.extractProp(s,"by"),this.__orientation=a.extractProp(s,"horizontal",!1)?"horizontal":"vertical",this.__context=h(a,this.__isMultiple,this.__orientation,()=>this.__activateSelectedOrFirst());let t=a.extractProp(s,"default-value",this.__isMultiple?[]:null);this.__value=t,queueMicrotask(()=>{a.effect(()=>{this.__inputName&&c(a,this.$el,this.__inputName,this.__value)}),a.effect(()=>{this.__resetInput()})})},__resetInput(){let t=this.$refs.__input;if(!t)return;let i=this.$data.__getCurrentValue();t.value=i},__getCurrentValue(){return!this.$refs.__input||!this.__value?"":this.$data.__displayValue&&this.__value!==void 0?this.$data.__displayValue(this.__value):typeof this.__value=="string"?this.__value:""},__open(){if(this.__isOpen)return;this.__isOpen=!0,this.__activateSelectedOrFirst(),(i=>requestAnimationFrame(()=>requestAnimationFrame(i)))(()=>this.$refs.__options.focus({preventScroll:!0}))},__close(){this.__isOpen=!1,this.__context.deactivate(),this.$nextTick(()=>this.$refs.__button.focus({preventScroll:!0}))},__activateSelectedOrFirst(t=!0){if(!this.__isOpen)return;if(this.__context.getActiveKey()){this.__context.activateAndScrollToKey(this.__context.getActiveKey());return}let i;if(this.__isMultiple?i=this.__value.find(e=>!!this.__context.getItemByValue(e)):i=this.__value,t&&i){let e=this.__context.getItemByValue(i);e&&this.__context.activateAndScrollToKey(e.key)}else this.__context.activateAndScrollToKey(this.__context.firstKey())},__selectActive(){let t=this.$data.__context.getActiveItem();t&&this.__toggleSelected(t.value)},__selectOption(t){let i=this.__context.getItemByEl(t);i&&this.__toggleSelected(i.value)},__isSelected(t){let i=this.__context.getItemByEl(t);return!i||i.value===null||i.value===void 0?!1:this.__hasSelected(i.value)},__toggleSelected(t){if(!this.__isMultiple){this.__value=t;return}let i=this.__value.findIndex(e=>this.__compare(e,t));i===-1?this.__value.push(t):this.__value.splice(i,1)},__hasSelected(t){return this.__isMultiple?this.__value.some(i=>this.__compare(i,t)):this.__compare(this.__value,t)},__compare(t,i){let e=this.__compareBy;if(e||(e=(r,l)=>a.raw(r)===a.raw(l)),typeof e=="string"){let r=e;e=(l,n)=>!l||typeof l!="object"||!n||typeof n!="object"?a.raw(l)===a.raw(n):l[r]===n[r]}return e(t,i)}}}})}function K(s,a){a.bind(s,{"x-ref":"__label",":id"(){return this.$id("alpine-listbox-label")},"@click"(){this.$refs.__button.focus({preventScroll:!0})}})}function b(s,a){a.bind(s,{"x-ref":"__button",":id"(){return this.$id("alpine-listbox-button")},"aria-haspopup":"true",":aria-labelledby"(){return this.$id("alpine-listbox-label")},":aria-expanded"(){return this.$data.__isOpen},":aria-controls"(){return this.$data.__isOpen&&this.$id("alpine-listbox-options")},"x-init"(){this.$el.tagName.toLowerCase()==="button"&&!this.$el.hasAttribute("type")&&(this.$el.type="button")},"@click"(){this.$data.__open()},"@keydown"(t){["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(t.key)&&(t.stopPropagation(),t.preventDefault(),this.$data.__open())},"@keydown.space.stop.prevent"(){this.$data.__open()},"@keydown.enter.stop.prevent"(){this.$data.__open()}})}function m(s,a){a.bind(s,{"x-ref":"__options",":id"(){return this.$id("alpine-listbox-options")},role:"listbox",tabindex:"0",":aria-orientation"(){return this.$data.__orientation},":aria-labelledby"(){return this.$id("alpine-listbox-button")},":aria-activedescendant"(){if(!this.$data.__context.hasActive())return;let t=this.$data.__context.getActiveItem();return t?t.el.id:null},"x-init"(){this.$data.__isStatic=a.extractProp(this.$el,"static",!1),a.bound(this.$el,"hold")&&(this.$data.__hold=!0)},"x-show"(){return this.$data.__isStatic?!0:this.$data.__isOpen},"x-trap"(){return this.$data.__isOpen},"@click.outside"(){this.$data.__close()},"@keydown.escape.stop.prevent"(){this.$data.__close()},"@focus"(){this.$data.__activateSelectedOrFirst()},"@keydown"(t){queueMicrotask(()=>this.$data.__context.activateByKeyEvent(t,!0,()=>this.$data.__isOpen,()=>this.$data.__open(),()=>{}))},"@keydown.enter.stop.prevent"(){this.$data.__selectActive(),this.$data.__isMultiple||this.$data.__close()},"@keydown.space.stop.prevent"(){this.$data.__selectActive(),this.$data.__isMultiple||this.$data.__close()}})}function x(s,a){a.bind(s,()=>({"x-id"(){return["alpine-listbox-option"]},":id"(){return this.$id("alpine-listbox-option")},role:"option",":tabindex"(){return this.$listboxOption.isDisabled?!1:"-1"},":aria-selected"(){return this.$listboxOption.isSelected},"x-data"(){return{__optionKey:null,init(){this.__optionKey=(Math.random()+1).toString(36).substring(7);let t=a.extractProp(s,"value"),i=a.extractProp(s,"disabled",!1,!1);this.$data.__context.registerItem(this.__optionKey,s,t,i)},destroy(){this.$data.__context.unregisterItem(this.__optionKey)}}},"@click"(){this.$listboxOption.isDisabled||(this.$data.__selectOption(s),this.$data.__isMultiple||this.$data.__close())},"@mouseenter"(){this.$data.__context.activateEl(s)},"@mouseleave"(){this.$data.__hold||this.$data.__context.deactivate()}}))}window.addEventListener("alpine:init",()=>{window.Alpine.plugin(y)});})();
